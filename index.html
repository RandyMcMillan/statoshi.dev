<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Statoshi by jlopp</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Statoshi</h1>
          <h2>Realtime Bitcoin Node Statistics</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/jlopp/statoshi/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/jlopp/statoshi/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/jlopp/statoshi" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><img src="http://lopp.net/images/statoshi.png" alt="Statoshi"></p>

<h1>
<a id="installation-and-dependencies" class="anchor" href="#installation-and-dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation and Dependencies</h1>

<p><em>NOTE: This guide has only been tested on Ubuntu; if you run into issues installing, please contact <a href="https://github.com/jlopp" class="user-mention">@jlopp</a></em></p>

<p>1) Install <a href="http://nodejs.org/download/">node.js</a></p>

<p>2) Install <a href="http://blog.nodejitsu.com/keep-a-nodejs-server-up-with-forever/">Forever</a>
    sudo npm install forever</p>

<p>3) Install <a href="https://github.com/etsy/statsd">StatsD</a>.</p>

<p>Create a config.js file copied from /opt/statsd/exampleConfig.js; at the minimum it should contain:</p>

<pre><code>    {
        graphitePort: 2003
        , graphiteHost: "127.0.0.1"
        , port: 8125
        , backends: [ "./backends/graphite" ]
    }
</code></pre>

<p>Start statsd:
    forever start /opt/statsd/stats.js /opt/statsd/config.js</p>

<p>4) <a href="https://httpd.apache.org/download.cgi">Download</a> and install Apache HTTPD Server. If you’re running Linux, it’s probably easier to install via your package manager.</p>

<p>5) Install software to visualize the stats collected by StatsD. We recommend <a href="http://graphite.wikidot.com/installation">Graphite</a>. Make sure you install a version newer than 0.9.12 for <a href="http://grafana.org/docs/performance/">maximum Grafana performance.</a>
For Graphite, once you have it installed you’ll want to configure how it stores the data from StatsD, in the graphite/conf/storage-schemas.conf:</p>

<pre><code>[carbon]
pattern = ^carbon\.
retentions = 10:2160,60:10080,600:262974

[stats]
priority = 110
pattern = ^stats\..*
retentions = 10:2160,60:10080,600:262974

[default]
pattern = .*
retentions = 10:2160,60:10080,600:262974
</code></pre>

<p>To prevent loss of sparse data you'll also need to modify Graphite's graphite/conf/storage-aggregation.conf:</p>

<pre><code>[min]
pattern = \.min$
xFilesFactor = 0.0
aggregationMethod = min

[max]
pattern = \.max$
xFilesFactor = 0.0
aggregationMethod = max

[sum]
pattern = \.count$
xFilesFactor = 0.0
aggregationMethod = sum

[default_average]
pattern = .*
xFilesFactor = 0.0
aggregationMethod = average
</code></pre>

<p>Run the carbon cache for Graphie:</p>

<pre><code>sudo /opt/graphite/bin/carbon-cache.py start
</code></pre>

<p>Optional performance improvement: install <a href="http://www.memcached.org/downloads">memcached</a></p>

<pre><code>sudo apt-get install memcached
</code></pre>

<p>Enabled memcached in /opt/graphite/webapp/graphite/local_settings.py</p>

<pre><code>MEMCACHE_HOSTS = ['127.0.0.1:11211']
DEFAULT_CACHE_DURATION = 600
</code></pre>

<p>6) Download (or git clone) the Statoshi fork:</p>

<pre><code>    jameson@lopp:~/workspace/$ git clone https://github.com/jlopp/statoshi.git
    Cloning into ‘statoshi’…
    remote: Reusing existing pack: 35655, done.
    remote: Total 35655 (delta 0), reused 0 (delta 0)
    Receiving objects: 100% (35655/35655), 26.56 MiB | 2.37 MiB/s, done.
    Resolving deltas: 100% (25766/25766), done.
    Checking connectivity… done
</code></pre>

<p>7) Compile the project. This can be a bit tricky if it's your first time due to the dependencies; you'll likely want to read the documentation:</p>

<ul>
<li>Linux build notes are <a href="https://github.com/jlopp/statoshi/blob/master/doc/build-unix.md">here</a>
</li>
<li>OSX build notes are <a href="https://github.com/jlopp/statoshi/blob/master/doc/build-osx.md">here</a>
</li>
<li>Windows build notes are <a href="https://github.com/jlopp/statoshi/blob/master/doc/build-msw.md">here</a>
</li>
</ul>

<p>Once you think you have all of the dependencies installed, build the project. For Linux, the commands are:</p>

<pre><code>    jameson@lopp:~/$ cd /path/to/statoshi/
    jameson@lopp:~/workspace/statoshi/$ ./autogen.sh
    jameson@lopp:~/workspace/statoshi/$ ./configure
    jameson@lopp:~/workspace/statoshi/$ make
</code></pre>

<p>It may take 20+ minutes to build, depending upon the speed of your computer. If you’re missing a dependency, you should receive an error noting what is missing.</p>

<p>Note that the Statoshi project assumes that you are running StatsD on the same machine as your Bitcoin node. If you wish to run StatsD on a different machine or non-default port, you’ll need to edit the default configuration on line 16 of <strong>/statoshi/src/statsd_client.h</strong> before building the project.</p>

<p>8) Set some values in your bitcoin.conf file; the 'gettxoutsetinfo' command ensures that UTXO metrics get populated after each new block arrives. The same goes for the 'getmininginfo' command. Note that you probably don't want to set the blocknotify command until your node is synced to the chain tip, otherwise it will slow down the node's initial sync.</p>

<pre><code>rpcuser=unguessableUser3256
rpcpassword=someRandomPasswordWithEntropyHere
blocknotify=/path/to/bitcoin-cli getmininginfo &amp;&amp; sleep 30 &amp;&amp; /path/to/bitcoin-cli gettxoutsetinfo
</code></pre>

<p>9) Start your Statoshi node (either the GUI or the command line daemon) - the Linux commands for them are:</p>

<pre><code>    GUI: /path/to/statoshi/src/qt/bitcoin-qt &amp;
    Daemon: /path/to/statoshi/src/bitcoind -daemon
</code></pre>

<p>Now you can check out the stats as they roll in to Graphite; you should see graphs begin to be populated within 30 seconds!</p>

<p>10) If you wish to duplicate the UI on <a href="http://statoshi.info">statoshi.info</a>, you'll also need to install Grafana. You can find <a href="http://docs.grafana.org/installation/">installation instructions here</a>.</p>

<p>Since Graphite runs on port 3000, you can have Apache proxy requests to it by:</p>

<pre><code>    jameson@lopp:~/$ sudo a2enmod proxy 
    jameson@lopp:~/$ sudo a2enmod proxy_http
</code></pre>

<p>Add to apache2.conf:</p>

<pre><code>    &lt;VirtualHost *:80&gt;
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    &lt;/VirtualHost&gt;
</code></pre>

<p>Restart Apache: sudo service apache2 restart</p>

<p>Once you install Grafana, you can load the dashboards from <a href="http://statoshi.info">statoshi.info</a> by clicking on the 'settings' icon in the upper left of statoshi.info and selecting "View JSON." Then import the JSON into your own Statoshi instance. The home dashboard is a special case - it can only be modified by updating the json file located at
/usr/share/grafana/public/dashboards/home.json</p>
        </section>

        <footer>
          Statoshi is maintained by <a href="https://github.com/jlopp">jlopp</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
