# Contributor: 
# Maintainer: 
pkgname=statoshi
pkgver=1.1.1.1
pkgrel=0
pkgdesc="Statoshi - Realtime Bitcoin Node Stats"
url="https://github.com/bitcoincore-dev/stats.bitcoincore.dev"
arch="all !armhf"
license="MIT"
makedepends="autoconf automake libtool boost-dev openssl-dev db-dev miniupnpc-dev
	qt5-qtbase-dev qt5-qttools-dev protobuf-dev libqrencode-dev libevent-dev chrpath zeromq-dev"
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.pre-install"
subpackages="bitcoin-dev bitcoin-qt bitcoin-cli bitcoin-tx bitcoin-tests bitcoin-bench
source="stats.bitcoincore.dev-$pkgver.tar.gz::https://github.com/bitcoincore-dev/stats.bitcoincore.dev/archive/v$pkgver.tar.gz
	$HOME/stats.bitcoincore.dev/package/$pkgname.initd
	$HOME/stats.bitcoincore.dev/package/$pkgname.conf
	"

prepare() {
	default_prepare
	$HOME/stats.bitcoincore.dev/package/src/stats.bitcoincore.dev-$pkgver/./autogen.sh
}

build() {
	$HOME/stats.bitcoincore.dev/package/src/stats.bitcoincore.dev-$pkgver/./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--mandir=/usr/share/man \
		--with-gui=no \
		--with-utils \
		--without-miniupnpc \
		--disable-bench \
		--disable-wallet \
		--disable-tests \
		--disable-man \
		--disable-ccache \
		--disable-static \
		--disable-hardening
	make
}

check() {
	make check
}

package() {
	make install DESTDIR="$pkgdir"
	install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -m600 -D "$srcdir"/$pkgname.conf "$pkgdir"/etc/$pkgname.conf
	rm -f "$pkgdir"/usr/lib/*.la
}


cli() {
	pkgdesc="Bitcoin CLI"
	mkdir -p "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/bitcoin-cli "$subpkgdir"/usr/bin/
}

tx() {
	pkgdesc="Bitcoin TX (Transaction Tool)"
	mkdir -p "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/bitcoin-tx "$subpkgdir"/usr/bin/
}


sha512sums="4fd96267d42a1fb3e5cb56ea7743d5137805ac6680378da35a7b2911012985f3a10f4858fc01b42f281c03e80f6e7801524d63d12f560ae79aa8fa31b1668be6  stats.bitcoincore.dev-1.1.1.1.tar.gz
82bbed3d4cbd0fa69c847fa4b21162bec24c34aeaf7da091a1ad0bc0024a0a0fd8481645762ecd82f7293cd8af5ddb0ecfa2c68455efe27fe75617632d6ff348  statoshi.initd
a31210d8db76c5a9b614a6de756c1678c0344898565ac3e5d6a34ac1bed66aec4964f1dc874294bc978f53b0e961df921655f7309df19b66c90aa6bd40379a09  statoshi.conf"
